<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Configuring EcoExtract for Your Data • ecoextract</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Configuring EcoExtract for Your Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ecoextract</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/ecoextract-workflow.html">Guide</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/configuration.html">Configuration</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/testing.html">Testing</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/n8layman/ecoextract/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Configuring EcoExtract for Your Data</h1>
                        <h4 data-toc-skip class="author">EcoExtract
Team</h4>
            
            <h4 data-toc-skip class="date">2026-02-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/n8layman/ecoextract/blob/main/vignettes/configuration.Rmd" class="external-link"><code>vignettes/configuration.Rmd</code></a></small>
      <div class="d-none name"><code>configuration.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>EcoExtract is domain-agnostic and works with any JSON schema you
define. This guide teaches you how to customize EcoExtract to extract
exactly the data you need for your research domain.</p>
<div class="section level3">
<h3 id="what-youll-learn">What You’ll Learn<a class="anchor" aria-label="anchor" href="#what-youll-learn"></a>
</h3>
<ul>
<li>How to create custom configuration files</li>
<li>How to define your data schema (what fields to extract)</li>
<li>How to write extraction prompts (how to extract those fields)</li>
<li>How to use array fields for multi-valued data</li>
<li>How to work with required vs optional fields</li>
<li>How to test and iterate on your configuration</li>
</ul>
</div>
<div class="section level3">
<h3 id="configuration-files">Configuration Files<a class="anchor" aria-label="anchor" href="#configuration-files"></a>
</h3>
<p>EcoExtract’s extraction behavior is controlled by two key
configuration files:</p>
<ol style="list-style-type: decimal">
<li>
<strong><code>schema.json</code></strong> - Defines the structure of
extracted data (what fields, what types)</li>
<li>
<strong><code>extraction_prompt.md</code></strong> - Provides
instructions to the LLM (how to extract, edge cases)</li>
</ol>
<p>There’s also an optional refinement prompt:</p>
<ol start="3" style="list-style-type: decimal">
<li>
<strong><code>refinement_prompt.md</code></strong> - Instructions
for the refinement step (validating and enhancing data)</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="understanding-the-schema">Understanding the Schema<a class="anchor" aria-label="anchor" href="#understanding-the-schema"></a>
</h2>
<div class="section level3">
<h3 id="schema-basics">Schema Basics<a class="anchor" aria-label="anchor" href="#schema-basics"></a>
</h3>
<p>The schema is a JSON file that defines:</p>
<ul>
<li>What fields should be extracted</li>
<li>What data types each field should have</li>
<li>Which fields are required vs optional</li>
<li>How to validate the extracted data</li>
<li>Which fields uniquely identify records</li>
</ul>
</div>
<div class="section level3">
<h3 id="required-structure">Required Structure<a class="anchor" aria-label="anchor" href="#required-structure"></a>
</h3>
<p>Your schema <strong>must</strong> follow this structure:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="dt">"$schema"</span><span class="fu">:</span> <span class="st">"http://json-schema.org/draft-07/schema#"</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="dt">"title"</span><span class="fu">:</span> <span class="st">"Your Domain Schema Title"</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"object"</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    <span class="dt">"records"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>      <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"array"</span><span class="fu">,</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>      <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Array of extracted records"</span><span class="fu">,</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>      <span class="dt">"items"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"object"</span><span class="fu">,</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>        <span class="dt">"required"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"field1"</span><span class="ot">,</span> <span class="st">"field2"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>        <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>          <span class="dt">"field1"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Description of field1"</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>          <span class="fu">},</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>          <span class="dt">"field2"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"integer"</span><span class="fu">,</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Description of field2"</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>        <span class="dt">"x-unique-fields"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"field1"</span><span class="ot">,</span> <span class="st">"field2"</span><span class="ot">]</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>  <span class="dt">"required"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"records"</span><span class="ot">]</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Key requirements:</p>
<ul>
<li>Top-level must have a <code>records</code> property (array of
objects)</li>
<li>Each field should have a <code>type</code> and
<code>description</code>
</li>
<li>Use <code>required</code> array to specify required fields</li>
<li>Use <code>x-unique-fields</code> to identify fields that define
uniqueness (used for deduplication and accuracy)</li>
</ul>
</div>
<div class="section level3">
<h3 id="field-types">Field Types<a class="anchor" aria-label="anchor" href="#field-types"></a>
</h3>
<p>The schema supports standard JSON Schema types:</p>
<table class="table">
<thead><tr class="header">
<th>JSON Type</th>
<th>SQLite Type</th>
<th>R Type</th>
<th>Example</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>string</code></td>
<td>TEXT</td>
<td>character</td>
<td>“Myotis lucifugus”</td>
</tr>
<tr class="even">
<td><code>integer</code></td>
<td>INTEGER</td>
<td>integer</td>
<td>2023</td>
</tr>
<tr class="odd">
<td><code>number</code></td>
<td>REAL</td>
<td>numeric</td>
<td>45.123</td>
</tr>
<tr class="even">
<td><code>boolean</code></td>
<td>BOOLEAN</td>
<td>logical</td>
<td>true</td>
</tr>
<tr class="odd">
<td><code>array</code></td>
<td>TEXT (JSON)</td>
<td>list</td>
<td>[“sentence 1”, “sentence 2”]</td>
</tr>
<tr class="even">
<td><code>object</code></td>
<td>TEXT (JSON)</td>
<td>list</td>
<td>{“lat”: 45, “lon”: -122}</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="reserved-system-field">Reserved System Field<a class="anchor" aria-label="anchor" href="#reserved-system-field"></a>
</h3>
<p><strong>⚠️ IMPORTANT</strong>: <code>record_id</code> is a reserved
system field:</p>
<ul>
<li>
<strong>Format</strong>: <code>AuthorYear-oN</code> (e.g.,
<code>Smith2020-o1</code>)</li>
<li>
<strong>Purpose</strong>: Unique identifier for each record</li>
<li>
<strong>Generated</strong>: Automatically by the system</li>
<li>
<strong>Do NOT include in your schema</strong> - this is managed
internally</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="creating-custom-configuration">Creating Custom Configuration<a class="anchor" aria-label="anchor" href="#creating-custom-configuration"></a>
</h2>
<div class="section level3">
<h3 id="step-1-initialize-configuration">Step 1: Initialize Configuration<a class="anchor" aria-label="anchor" href="#step-1-initialize-configuration"></a>
</h3>
<p>Create template configuration files in your project:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/n8layman/ecoextract" class="external-link">ecoextract</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Creates ecoextract/ directory with template files</span></span>
<span><span class="fu"><a href="../reference/init_ecoextract.html">init_ecoextract</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This creates:</p>
<ul>
<li>
<code>ecoextract/SCHEMA_GUIDE.md</code> - Read this first!</li>
<li>
<code>ecoextract/schema.json</code> - Template schema to
customize</li>
<li>
<code>ecoextract/extraction_prompt.md</code> - Template prompt to
customize</li>
</ul>
</div>
<div class="section level3">
<h3 id="step-2-edit-the-schema">Step 2: Edit the Schema<a class="anchor" aria-label="anchor" href="#step-2-edit-the-schema"></a>
</h3>
<p>Open <code>ecoextract/schema.json</code> and customize for your
domain.</p>
<div class="section level4">
<h4 id="example-1-simple-schema-disease-outbreaks">Example 1: Simple Schema (Disease Outbreaks)<a class="anchor" aria-label="anchor" href="#example-1-simple-schema-disease-outbreaks"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="dt">"$schema"</span><span class="fu">:</span> <span class="st">"http://json-schema.org/draft-07/schema#"</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="dt">"title"</span><span class="fu">:</span> <span class="st">"Disease Outbreak Schema"</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Schema for extracting disease outbreak data from epidemiological literature"</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"object"</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="dt">"records"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>      <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"array"</span><span class="fu">,</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>      <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Array of disease outbreak records"</span><span class="fu">,</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>      <span class="dt">"items"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"object"</span><span class="fu">,</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>        <span class="dt">"required"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>          <span class="st">"disease_name"</span><span class="ot">,</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>          <span class="st">"location"</span><span class="ot">,</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>          <span class="st">"year"</span><span class="ot">,</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>          <span class="st">"all_supporting_source_sentences"</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>        <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>        <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>          <span class="dt">"disease_name"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Name of the disease (e.g., 'COVID-19', 'Influenza A(H1N1)')"</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>          <span class="fu">},</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>          <span class="dt">"location"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Geographic location of outbreak (city, region, or country)"</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>          <span class="fu">},</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>          <span class="dt">"year"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"integer"</span><span class="fu">,</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Year the outbreak occurred"</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>          <span class="fu">},</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>          <span class="dt">"cases"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"integer"</span><span class="fu">,</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Total number of cases reported"</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>          <span class="fu">},</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>          <span class="dt">"deaths"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"integer"</span><span class="fu">,</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Total number of deaths reported"</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>          <span class="fu">},</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>          <span class="dt">"all_supporting_source_sentences"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"array"</span><span class="fu">,</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"All sentences from the document that support this record"</span><span class="fu">,</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a>            <span class="dt">"items"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a>              <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a>              <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Individual supporting sentence"</span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a>        <span class="dt">"x-unique-fields"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"disease_name"</span><span class="ot">,</span> <span class="st">"location"</span><span class="ot">,</span> <span class="st">"year"</span><span class="ot">]</span></span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a>  <span class="dt">"required"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"records"</span><span class="ot">]</span></span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="example-2-complex-schema-with-arrays-host-pathogen-interactions">Example 2: Complex Schema with Arrays (Host-Pathogen
Interactions)<a class="anchor" aria-label="anchor" href="#example-2-complex-schema-with-arrays-host-pathogen-interactions"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="dt">"$schema"</span><span class="fu">:</span> <span class="st">"http://json-schema.org/draft-07/schema#"</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="dt">"title"</span><span class="fu">:</span> <span class="st">"Host-Pathogen Interaction Schema"</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"object"</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="dt">"records"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>      <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"array"</span><span class="fu">,</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>      <span class="dt">"items"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"object"</span><span class="fu">,</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>        <span class="dt">"required"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>          <span class="st">"Pathogen_Name"</span><span class="ot">,</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>          <span class="st">"Host_Name"</span><span class="ot">,</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>          <span class="st">"Detection_Method"</span><span class="ot">,</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>          <span class="st">"all_supporting_source_sentences"</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>        <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>        <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>          <span class="dt">"Pathogen_Name"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Scientific name of the pathogen"</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>          <span class="fu">},</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>          <span class="dt">"Host_Name"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Scientific name of the host organism"</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>          <span class="fu">},</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>          <span class="dt">"Detection_Method"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"array"</span><span class="fu">,</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Methods used to detect the pathogen (can be multiple)"</span><span class="fu">,</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>            <span class="dt">"items"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>              <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>              <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Individual detection method (e.g., 'PCR', 'culture', 'serology')"</span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>          <span class="fu">},</span></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>          <span class="dt">"Sample_type"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"array"</span><span class="fu">,</span></span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Types of samples collected (can be multiple)"</span><span class="fu">,</span></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a>            <span class="dt">"items"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a>              <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a>              <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Individual sample type (e.g., 'blood', 'tissue', 'fecal swab')"</span></span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a>          <span class="fu">},</span></span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a>          <span class="dt">"Location"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Geographic location where interaction was documented"</span></span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a>          <span class="fu">},</span></span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a>          <span class="dt">"all_supporting_source_sentences"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"array"</span><span class="fu">,</span></span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"All sentences from document supporting this record"</span><span class="fu">,</span></span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a>            <span class="dt">"items"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-49"><a href="#cb4-49" tabindex="-1"></a>              <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span></span>
<span id="cb4-50"><a href="#cb4-50" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb4-51"><a href="#cb4-51" tabindex="-1"></a>          <span class="fu">},</span></span>
<span id="cb4-52"><a href="#cb4-52" tabindex="-1"></a>          <span class="dt">"Confidence_Score"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-53"><a href="#cb4-53" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"integer"</span><span class="fu">,</span></span>
<span id="cb4-54"><a href="#cb4-54" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Confidence in extraction accuracy (1-5 scale)"</span></span>
<span id="cb4-55"><a href="#cb4-55" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb4-56"><a href="#cb4-56" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb4-57"><a href="#cb4-57" tabindex="-1"></a>        <span class="dt">"x-unique-fields"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"Pathogen_Name"</span><span class="ot">,</span> <span class="st">"Host_Name"</span><span class="ot">]</span></span>
<span id="cb4-58"><a href="#cb4-58" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb4-59"><a href="#cb4-59" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb4-60"><a href="#cb4-60" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb4-61"><a href="#cb4-61" tabindex="-1"></a>  <span class="dt">"required"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"records"</span><span class="ot">]</span></span>
<span id="cb4-62"><a href="#cb4-62" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="step-3-edit-the-extraction-prompt">Step 3: Edit the Extraction Prompt<a class="anchor" aria-label="anchor" href="#step-3-edit-the-extraction-prompt"></a>
</h3>
<p>Open <code>ecoextract/extraction_prompt.md</code> and customize the
instructions for your domain.</p>
<div class="section level4">
<h4 id="prompt-structure">Prompt Structure<a class="anchor" aria-label="anchor" href="#prompt-structure"></a>
</h4>
<p>A good extraction prompt should include:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Task description</strong> - What you’re extracting and
why</li>
<li>
<strong>Field definitions</strong> - Clear explanation of each
field</li>
<li>
<strong>Extraction rules</strong> - When to create separate
records</li>
<li>
<strong>Edge case handling</strong> - What to do with ambiguous
cases</li>
<li>
<strong>Quality guidelines</strong> - Standards for completeness and
accuracy</li>
</ol>
</div>
<div class="section level4">
<h4 id="example-prompt-disease-outbreaks">Example Prompt (Disease Outbreaks)<a class="anchor" aria-label="anchor" href="#example-prompt-disease-outbreaks"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu"># Task</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>Extract all disease outbreak events mentioned in this epidemiological document.</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>Each outbreak should be a separate record.</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="fu"># Field Definitions</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="ss">- </span>**disease_name**: The specific disease or pathogen name. Use the most specific</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  name mentioned (e.g., "Influenza A(H1N1)" not just "Influenza").</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="ss">- </span>**location**: Geographic location where outbreak occurred. Use the most specific</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>  location mentioned (city &gt; region &gt; country).</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="ss">- </span>**year**: Year the outbreak occurred (4-digit year).</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="ss">- </span>**cases**: Total number of confirmed or suspected cases. Extract only if explicitly</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>  stated.</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="ss">- </span>**deaths**: Total number of deaths attributed to the outbreak. Extract only if</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>  explicitly stated.</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="ss">- </span>**all_supporting_source_sentences**: Include every sentence that provides</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>  information about this outbreak. Include the full sentence verbatim.</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="fu"># Extraction Rules</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="fu">## One Record Per Outbreak</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>Create separate records for:</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="ss">- </span>Different diseases in the same location</span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a><span class="ss">- </span>Same disease in different locations</span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a><span class="ss">- </span>Same disease in same location but different time periods</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a><span class="fu">## Handling Uncertainty</span></span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a><span class="ss">- </span>If year is not explicitly stated, try to infer from context</span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a><span class="ss">- </span>If location is ambiguous, use the most likely interpretation</span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a><span class="ss">- </span>If case/death counts are ranges, use the midpoint</span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a><span class="ss">- </span>Mark low-confidence extractions with Confidence_Score = 2 or 3</span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a></span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a><span class="fu">## Multiple Mentions</span></span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a>If an outbreak is mentioned multiple times, create ONE record and include</span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a>all supporting sentences.</span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a><span class="fu"># Quality Standards</span></span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a><span class="ss">- </span>Prioritize completeness: extract all outbreaks mentioned</span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a><span class="ss">- </span>Include all supporting sentences for each record</span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a><span class="ss">- </span>Be precise with location and disease names</span>
<span id="cb5-51"><a href="#cb5-51" tabindex="-1"></a><span class="ss">- </span>Don't hallucinate: only extract what's explicitly stated or clearly implied</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="step-4-test-your-configuration">Step 4: Test Your Configuration<a class="anchor" aria-label="anchor" href="#step-4-test-your-configuration"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Process a test document with your custom configuration</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"test_paper.pdf"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"test.db"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve and inspect results</span></span>
<span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_records.html">get_records</a></span><span class="op">(</span>db_conn <span class="op">=</span> <span class="st">"test.db"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">records</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check what was extracted</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">records</span><span class="op">)</span>  <span class="co"># Should match your schema fields</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">records</span><span class="op">)</span>    <span class="co"># Check data types</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-5-iterate-and-refine">Step 5: Iterate and Refine<a class="anchor" aria-label="anchor" href="#step-5-iterate-and-refine"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Common iterations:</span></span>
<span><span class="co"># 1. Adjust field descriptions in schema</span></span>
<span><span class="co"># 2. Add edge case handling in prompt</span></span>
<span><span class="co"># 3. Reprocess with force flag</span></span>
<span><span class="co"># 4. Review results in ecoreview app</span></span>
<span></span>
<span><span class="co"># Force reprocess after changing schema/prompt</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"test_paper.pdf"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"test.db"</span>,</span>
<span>  force_reprocess_extraction <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="working-with-array-fields">Working with Array Fields<a class="anchor" aria-label="anchor" href="#working-with-array-fields"></a>
</h2>
<p>Array fields let you capture multi-valued data like: - Multiple
detection methods per observation - Multiple sample types - Multiple
supporting sentences - Multiple geographic locations</p>
<div class="section level3">
<h3 id="defining-array-fields">Defining Array Fields<a class="anchor" aria-label="anchor" href="#defining-array-fields"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="dt">"detection_methods"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"array"</span><span class="fu">,</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"All methods used to detect the organism"</span><span class="fu">,</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    <span class="dt">"items"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>      <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>      <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Individual detection method (e.g., 'PCR', 'culture', 'ELISA')"</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="instructing-the-llm-on-arrays">Instructing the LLM on Arrays<a class="anchor" aria-label="anchor" href="#instructing-the-llm-on-arrays"></a>
</h3>
<p>In your extraction prompt, clearly explain when to use arrays:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">## detection_methods (array)</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>List ALL methods mentioned for detecting this organism. Each method should be a</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>separate array element.</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>Examples:</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="ss">- </span>If text says "detected by PCR and culture" → <span class="co">[</span><span class="ot">"PCR", "culture"</span><span class="co">]</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="ss">- </span>If text says "PCR-positive samples" → <span class="co">[</span><span class="ot">"PCR"</span><span class="co">]</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="ss">- </span>If text says "antibodies detected via ELISA" → <span class="co">[</span><span class="ot">"ELISA"</span><span class="co">]</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>Common methods: PCR, RT-PCR, qPCR, culture, serology, ELISA, Western blot,</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>microscopy, sequencing, antigen detection</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="retrieving-array-data-in-r">Retrieving Array Data in R<a class="anchor" aria-label="anchor" href="#retrieving-array-data-in-r"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get records with array fields</span></span>
<span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_records.html">get_records</a></span><span class="op">(</span>db_conn <span class="op">=</span> <span class="st">"records.db"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Array fields are stored as lists</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">records</span><span class="op">$</span><span class="va">detection_methods</span><span class="op">)</span>  <span class="co"># "list"</span></span>
<span></span>
<span><span class="co"># Unnest to see individual values</span></span>
<span><span class="va">records</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">detection_methods</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">record_id</span>, <span class="va">detection_methods</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Count frequency of each method</span></span>
<span><span class="va">records</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">detection_methods</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">detection_methods</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="best-practices-for-arrays">Best Practices for Arrays<a class="anchor" aria-label="anchor" href="#best-practices-for-arrays"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Be explicit in prompts</strong> - Show examples of single vs
multiple values</li>
<li>
<strong>Use consistent terminology</strong> - Define a controlled
vocabulary when possible</li>
<li>
<strong>Always include descriptions</strong> - Help the LLM
understand what belongs in the array</li>
<li>
<strong>Test with edge cases</strong> - Papers with 1 value, 5
values, 0 values</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="required-vs-optional-fields">Required vs Optional Fields<a class="anchor" aria-label="anchor" href="#required-vs-optional-fields"></a>
</h2>
<div class="section level3">
<h3 id="marking-required-fields">Marking Required Fields<a class="anchor" aria-label="anchor" href="#marking-required-fields"></a>
</h3>
<p>Use the <code>required</code> array in your schema:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="dt">"items"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"object"</span><span class="fu">,</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    <span class="dt">"required"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>      <span class="st">"pathogen_name"</span><span class="ot">,</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>      <span class="st">"host_name"</span><span class="ot">,</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>      <span class="st">"all_supporting_source_sentences"</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>      <span class="dt">"pathogen_name"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span> <span class="fu">},</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>      <span class="dt">"host_name"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span> <span class="fu">},</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>      <span class="dt">"location"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span> <span class="fu">},</span>  <span class="er">//</span> <span class="er">optional</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>      <span class="dt">"all_supporting_source_sentences"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"array"</span> <span class="fu">}</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="impact-of-required-fields">Impact of Required Fields<a class="anchor" aria-label="anchor" href="#impact-of-required-fields"></a>
</h3>
<p>Required fields affect:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Extraction validation</strong> - LLM must provide these
fields</li>
<li>
<strong>Accuracy calculation</strong> - Edits to required fields are
“major edits”</li>
<li>
<strong>Record completeness</strong> - Records without required
fields may be rejected</li>
</ol>
</div>
<div class="section level3">
<h3 id="guidelines-for-required-fields">Guidelines for Required Fields<a class="anchor" aria-label="anchor" href="#guidelines-for-required-fields"></a>
</h3>
<p><strong>Mark as required:</strong> - Core identifying information
(organism names, dates, locations) - Evidence fields
(<code>all_supporting_source_sentences</code>) - Fields needed for
deduplication</p>
<p><strong>Mark as optional:</strong> - Descriptive details that may not
always be present - Quantitative measurements (counts, concentrations) -
Contextual information</p>
</div>
</div>
<div class="section level2">
<h2 id="unique-fields-and-deduplication">Unique Fields and Deduplication<a class="anchor" aria-label="anchor" href="#unique-fields-and-deduplication"></a>
</h2>
<div class="section level3">
<h3 id="defining-unique-fields">Defining Unique Fields<a class="anchor" aria-label="anchor" href="#defining-unique-fields"></a>
</h3>
<p>Use <code>x-unique-fields</code> to specify which fields define
record uniqueness:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="dt">"items"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"object"</span><span class="fu">,</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>      <span class="dt">"pathogen_name"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span> <span class="fu">},</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>      <span class="dt">"host_name"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span> <span class="fu">},</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>      <span class="dt">"location"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span> <span class="fu">},</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>      <span class="dt">"sample_date"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span> <span class="fu">}</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>    <span class="dt">"x-unique-fields"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"pathogen_name"</span><span class="ot">,</span> <span class="st">"host_name"</span><span class="ot">,</span> <span class="st">"location"</span><span class="ot">]</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="how-unique-fields-are-used">How Unique Fields Are Used<a class="anchor" aria-label="anchor" href="#how-unique-fields-are-used"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Deduplication</strong> - Records with same unique field
values are considered duplicates</li>
<li>
<strong>Accuracy metrics</strong> - Edits to unique fields are
classified as “major edits”</li>
<li>
<strong>Review workflow</strong> - Helps identify truly distinct
records</li>
</ol>
</div>
<div class="section level3">
<h3 id="choosing-unique-fields">Choosing Unique Fields<a class="anchor" aria-label="anchor" href="#choosing-unique-fields"></a>
</h3>
<p>Good unique field combinations: - <strong>Species
interactions</strong>: species1 + species2 + interaction_type -
<strong>Disease outbreaks</strong>: disease + location + year -
<strong>Chemical measurements</strong>: chemical + sample_location +
date - <strong>Observations</strong>: organism + location + date +
observer</p>
</div>
</div>
<div class="section level2">
<h2 id="advanced-configuration">Advanced Configuration<a class="anchor" aria-label="anchor" href="#advanced-configuration"></a>
</h2>
<div class="section level3">
<h3 id="configuration-priority">Configuration Priority<a class="anchor" aria-label="anchor" href="#configuration-priority"></a>
</h3>
<p>EcoExtract looks for configuration files in this order:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Explicit parameter</strong> - Files you specify directly in
function calls</li>
<li>
<strong>Project ecoextract/ directory</strong> -
<code>ecoextract/schema.json</code>, etc.</li>
<li>
<strong>Working directory with prefix</strong> -
<code>ecoextract_schema.json</code>, etc.</li>
<li>
<strong>Package defaults</strong> - Built-in example schema</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Uses ecoextract/schema.json automatically</span></span>
<span><span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span><span class="st">"pdfs/"</span>, <span class="st">"records.db"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify custom path explicitly</span></span>
<span><span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"records.db"</span>,</span>
<span>  schema_file <span class="op">=</span> <span class="st">"custom/my_schema.json"</span>,</span>
<span>  extraction_prompt_file <span class="op">=</span> <span class="st">"custom/my_prompt.md"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="refinement-prompts">Refinement Prompts<a class="anchor" aria-label="anchor" href="#refinement-prompts"></a>
</h3>
<p>The refinement step validates and enhances extracted data. Customize
the refinement prompt for domain-specific validation:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run with custom refinement prompt</span></span>
<span><span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"records.db"</span>,</span>
<span>  run_refinement <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  refinement_prompt_file <span class="op">=</span> <span class="st">"ecoextract/refinement_prompt.md"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>A good refinement prompt should: - Validate field values against
known standards - Check for logical consistency - Enhance incomplete
records using context - Resolve ambiguities from extraction step</p>
</div>
<div class="section level3">
<h3 id="multiple-schemas-for-different-projects">Multiple Schemas for Different Projects<a class="anchor" aria-label="anchor" href="#multiple-schemas-for-different-projects"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Project 1: Disease outbreaks</span></span>
<span><span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  <span class="st">"disease_pdfs/"</span>,</span>
<span>  <span class="st">"disease.db"</span>,</span>
<span>  schema_file <span class="op">=</span> <span class="st">"schemas/disease_schema.json"</span>,</span>
<span>  extraction_prompt_file <span class="op">=</span> <span class="st">"prompts/disease_prompt.md"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Project 2: Species interactions</span></span>
<span><span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  <span class="st">"species_pdfs/"</span>,</span>
<span>  <span class="st">"species.db"</span>,</span>
<span>  schema_file <span class="op">=</span> <span class="st">"schemas/species_schema.json"</span>,</span>
<span>  extraction_prompt_file <span class="op">=</span> <span class="st">"prompts/species_prompt.md"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="complete-example-building-a-custom-schema">Complete Example: Building a Custom Schema<a class="anchor" aria-label="anchor" href="#complete-example-building-a-custom-schema"></a>
</h2>
<p>Let’s walk through creating a schema for extracting plant-pollinator
interactions:</p>
<div class="section level3">
<h3 id="define-your-domain">1. Define Your Domain<a class="anchor" aria-label="anchor" href="#define-your-domain"></a>
</h3>
<p>What information do we need? - Plant species (scientific name) -
Pollinator species (scientific name) - Interaction type (pollination,
nectar robbing, etc.) - Location (where observed) - Date/season (when
observed) - Supporting evidence</p>
</div>
<div class="section level3">
<h3 id="create-the-schema">2. Create the Schema<a class="anchor" aria-label="anchor" href="#create-the-schema"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># Save as ecoextract/schema.json</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>{</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="st">"$schema"</span><span class="sc">:</span> <span class="st">"http://json-schema.org/draft-07/schema#"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  <span class="st">"title"</span><span class="sc">:</span> <span class="st">"Plant-Pollinator Interaction Schema"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>  <span class="st">"type"</span><span class="sc">:</span> <span class="st">"object"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>  <span class="st">"properties"</span><span class="sc">:</span> {</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>    <span class="st">"records"</span><span class="sc">:</span> {</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>      <span class="st">"type"</span><span class="sc">:</span> <span class="st">"array"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>      <span class="st">"items"</span><span class="sc">:</span> {</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>        <span class="st">"type"</span><span class="sc">:</span> <span class="st">"object"</span>,</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>        <span class="st">"required"</span><span class="sc">:</span> [</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>          <span class="st">"plant_species"</span>,</span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>          <span class="st">"pollinator_species"</span>,</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>          <span class="st">"interaction_type"</span>,</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>          <span class="st">"all_supporting_source_sentences"</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>        ],</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>        <span class="st">"properties"</span><span class="sc">:</span> {</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>          <span class="st">"plant_species"</span><span class="sc">:</span> {</span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>            <span class="st">"type"</span><span class="sc">:</span> <span class="st">"string"</span>,</span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>            <span class="st">"description"</span><span class="sc">:</span> <span class="st">"Scientific name of plant species"</span></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a>          },</span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a>          <span class="st">"pollinator_species"</span><span class="sc">:</span> {</span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a>            <span class="st">"type"</span><span class="sc">:</span> <span class="st">"string"</span>,</span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a>            <span class="st">"description"</span><span class="sc">:</span> <span class="st">"Scientific name of pollinator species"</span></span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a>          },</span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a>          <span class="st">"interaction_type"</span><span class="sc">:</span> {</span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a>            <span class="st">"type"</span><span class="sc">:</span> <span class="st">"array"</span>,</span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a>            <span class="st">"items"</span><span class="sc">:</span> {</span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a>              <span class="st">"type"</span><span class="sc">:</span> <span class="st">"string"</span>,</span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a>              <span class="st">"description"</span><span class="sc">:</span> <span class="st">"Type of interaction: pollination, nectar_robbing, etc."</span></span>
<span id="cb16-31"><a href="#cb16-31" tabindex="-1"></a>            }</span>
<span id="cb16-32"><a href="#cb16-32" tabindex="-1"></a>          },</span>
<span id="cb16-33"><a href="#cb16-33" tabindex="-1"></a>          <span class="st">"location"</span><span class="sc">:</span> {</span>
<span id="cb16-34"><a href="#cb16-34" tabindex="-1"></a>            <span class="st">"type"</span><span class="sc">:</span> <span class="st">"string"</span>,</span>
<span id="cb16-35"><a href="#cb16-35" tabindex="-1"></a>            <span class="st">"description"</span><span class="sc">:</span> <span class="st">"Geographic location of observation"</span></span>
<span id="cb16-36"><a href="#cb16-36" tabindex="-1"></a>          },</span>
<span id="cb16-37"><a href="#cb16-37" tabindex="-1"></a>          <span class="st">"season"</span><span class="sc">:</span> {</span>
<span id="cb16-38"><a href="#cb16-38" tabindex="-1"></a>            <span class="st">"type"</span><span class="sc">:</span> <span class="st">"string"</span>,</span>
<span id="cb16-39"><a href="#cb16-39" tabindex="-1"></a>            <span class="st">"description"</span><span class="sc">:</span> <span class="st">"Season or months when interaction observed"</span></span>
<span id="cb16-40"><a href="#cb16-40" tabindex="-1"></a>          },</span>
<span id="cb16-41"><a href="#cb16-41" tabindex="-1"></a>          <span class="st">"all_supporting_source_sentences"</span><span class="sc">:</span> {</span>
<span id="cb16-42"><a href="#cb16-42" tabindex="-1"></a>            <span class="st">"type"</span><span class="sc">:</span> <span class="st">"array"</span>,</span>
<span id="cb16-43"><a href="#cb16-43" tabindex="-1"></a>            <span class="st">"items"</span><span class="sc">:</span> {</span>
<span id="cb16-44"><a href="#cb16-44" tabindex="-1"></a>              <span class="st">"type"</span><span class="sc">:</span> <span class="st">"string"</span></span>
<span id="cb16-45"><a href="#cb16-45" tabindex="-1"></a>            }</span>
<span id="cb16-46"><a href="#cb16-46" tabindex="-1"></a>          }</span>
<span id="cb16-47"><a href="#cb16-47" tabindex="-1"></a>        },</span>
<span id="cb16-48"><a href="#cb16-48" tabindex="-1"></a>        <span class="st">"x-unique-fields"</span><span class="sc">:</span> [<span class="st">"plant_species"</span>, <span class="st">"pollinator_species"</span>, <span class="st">"location"</span>]</span>
<span id="cb16-49"><a href="#cb16-49" tabindex="-1"></a>      }</span>
<span id="cb16-50"><a href="#cb16-50" tabindex="-1"></a>    }</span>
<span id="cb16-51"><a href="#cb16-51" tabindex="-1"></a>  },</span>
<span id="cb16-52"><a href="#cb16-52" tabindex="-1"></a>  <span class="st">"required"</span><span class="sc">:</span> [<span class="st">"records"</span>]</span>
<span id="cb16-53"><a href="#cb16-53" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="write-the-prompt">3. Write the Prompt<a class="anchor" aria-label="anchor" href="#write-the-prompt"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># Save as ecoextract/extraction_prompt.md</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co"># Task</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>Extract all plant<span class="sc">-</span>pollinator interactions reported <span class="cf">in</span> this document.</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co"># Field Definitions</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="sc">**</span>plant_species<span class="sc">**</span><span class="er">:</span> Scientific name of the <span class="fu">plant</span> (genus <span class="sc">+</span> species).</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="sc">**</span>pollinator_species<span class="sc">**</span><span class="er">:</span> Scientific name of the pollinator. Use the most specific</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>taxonomic level available.</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="sc">**</span>interaction_type<span class="sc">**</span><span class="er">:</span> <span class="fu">Type</span>(s) of interaction. Common types<span class="sc">:</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="sc">-</span> <span class="fu">pollination</span> (legitimate pollination)</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="sc">-</span> <span class="fu">nectar_robbing</span> (accessing nectar without pollinating)</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="sc">-</span> <span class="fu">pollen_collecting</span> (collecting pollen but not pollinating)</span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="sc">**</span>location<span class="sc">**</span><span class="er">:</span> Geographic location. Use most specific <span class="fu">available</span> (site <span class="sc">&gt;</span> region <span class="sc">&gt;</span> country).</span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a><span class="sc">**</span>season<span class="sc">**</span><span class="er">:</span> When the interaction was <span class="fu">observed</span> (season, months, or dates).</span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a><span class="sc">**</span>all_supporting_source_sentences<span class="sc">**</span><span class="er">:</span> All sentences providing information about</span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a>this interaction.</span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a><span class="co"># Extraction Rules</span></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a>Create one record per unique plant<span class="sc">-</span>pollinator<span class="sc">-</span>location combination.</span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a>If the same pair is observed <span class="cf">in</span> multiple seasons at the same location, create</span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a>separate records.</span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a><span class="co"># Examples</span></span>
<span id="cb17-33"><a href="#cb17-33" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" tabindex="-1"></a><span class="st">"Bombus terrestris was observed visiting Trifolium repens flowers in meadows</span></span>
<span id="cb17-35"><a href="#cb17-35" tabindex="-1"></a><span class="st">near Oxford during June and July."</span></span>
<span id="cb17-36"><a href="#cb17-36" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" tabindex="-1"></a>→ One record<span class="sc">:</span></span>
<span id="cb17-38"><a href="#cb17-38" tabindex="-1"></a><span class="sc">-</span> plant_species<span class="sc">:</span> <span class="st">"Trifolium repens"</span></span>
<span id="cb17-39"><a href="#cb17-39" tabindex="-1"></a><span class="sc">-</span> pollinator_species<span class="sc">:</span> <span class="st">"Bombus terrestris"</span></span>
<span id="cb17-40"><a href="#cb17-40" tabindex="-1"></a><span class="sc">-</span> interaction_type<span class="sc">:</span> [<span class="st">"pollination"</span>]</span>
<span id="cb17-41"><a href="#cb17-41" tabindex="-1"></a><span class="sc">-</span> location<span class="sc">:</span> <span class="st">"meadows near Oxford"</span></span>
<span id="cb17-42"><a href="#cb17-42" tabindex="-1"></a><span class="sc">-</span> season<span class="sc">:</span> <span class="st">"June and July"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="process-and-test">4. Process and Test<a class="anchor" aria-label="anchor" href="#process-and-test"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Process test documents</span></span>
<span><span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"pollinator_papers/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"pollinators.db"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Review results</span></span>
<span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_records.html">get_records</a></span><span class="op">(</span>db_conn <span class="op">=</span> <span class="st">"pollinators.db"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check extraction quality</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ecoreview</span><span class="op">)</span></span>
<span><span class="fu">run_review_app</span><span class="op">(</span><span class="st">"pollinators.db"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate accuracy after review</span></span>
<span><span class="va">accuracy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_accuracy.html">calculate_accuracy</a></span><span class="op">(</span><span class="st">"pollinators.db"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h2>
<div class="section level3">
<h3 id="schema-validation-errors">Schema Validation Errors<a class="anchor" aria-label="anchor" href="#schema-validation-errors"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Validate JSON syntax</span></span>
<span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/validate.html" class="external-link">validate</a></span><span class="op">(</span><span class="st">"ecoextract/schema.json"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read and inspect schema</span></span>
<span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/read_json.html" class="external-link">read_json</a></span><span class="op">(</span><span class="st">"ecoextract/schema.json"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">schema</span><span class="op">$</span><span class="va">properties</span><span class="op">)</span>  <span class="co"># Should include "records"</span></span>
<span></span>
<span><span class="co"># Test with default schema first</span></span>
<span><span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span><span class="st">"test.pdf"</span>, <span class="st">"test.db"</span>, schema_file <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="llm-not-following-instructions">LLM Not Following Instructions<a class="anchor" aria-label="anchor" href="#llm-not-following-instructions"></a>
</h3>
<p>If the LLM isn’t extracting correctly:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Make prompts more explicit</strong> - Add examples and edge
cases</li>
<li>
<strong>Simplify field descriptions</strong> - Use clear,
unambiguous language</li>
<li>
<strong>Check required fields</strong> - Too many required fields
can cause failures</li>
<li>
<strong>Test incrementally</strong> - Start with a simple schema,
add complexity gradually</li>
</ol>
</div>
<div class="section level3">
<h3 id="array-fields-not-working">Array Fields Not Working<a class="anchor" aria-label="anchor" href="#array-fields-not-working"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check if arrays are being recognized</span></span>
<span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_records.html">get_records</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">records</span><span class="op">$</span><span class="va">your_array_field</span><span class="op">)</span>  <span class="co"># Should be "list"</span></span>
<span></span>
<span><span class="co"># If it's character, arrays aren't being parsed correctly</span></span>
<span><span class="co"># Check schema has proper array definition:</span></span>
<span><span class="co"># "type": "array", "items": {"type": "string"}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>
<strong>Process your documents</strong> with your custom schema</li>
<li>
<strong>Launch the review app</strong> to validate extraction
quality</li>
<li>
<strong>Iterate on configuration</strong> based on results</li>
<li>
<strong>Calculate accuracy</strong> to measure performance</li>
</ul>
<div class="section level3">
<h3 id="additional-resources">Additional Resources<a class="anchor" aria-label="anchor" href="#additional-resources"></a>
</h3>
<ul>
<li>
<a href="ecoextract-workflow.html">Complete Workflow Guide</a> -
Full workflow reference</li>
<li>
<a href="../ACCURACY.html">ACCURACY.md</a> - Understanding accuracy
metrics</li>
<li>
<a href="../inst/extdata/SCHEMA_GUIDE.html">SCHEMA_GUIDE.md</a> -
Detailed schema specification</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nathan C Layman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>list(text = “EcoExtract - Structured ecological data extraction from scientific literature”)</p>
</div>

    </footer>
</div>



  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>
  mermaid.initialize({ startOnLoad: false, theme: "default" });
  document.querySelectorAll("pre.mermaid").forEach(function(pre) {
    var code = pre.querySelector("code");
    var text = code ? code.textContent : pre.textContent;
    var div = document.createElement("div");
    div.className = "mermaid";
    div.textContent = text;
    pre.parentElement.replaceChild(div, pre);
  });
  mermaid.run();
</script>
</body>
</html>
