<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Complete Workflow: From PDF to Database • ecoextract</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Complete Workflow: From PDF to Database">
</head>
<body>
<p>








  pkgdown/mermaid.html

  

  </p>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ecoextract</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Getting Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/ecoextract-workflow.html">Workflow</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/configuration.html">Configuration</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/testing.html">Testing</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/n8layman/ecoextract/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Complete Workflow: From PDF to Database</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/n8layman/ecoextract/blob/main/vignettes/ecoextract-workflow.Rmd" class="external-link"><code>vignettes/ecoextract-workflow.Rmd</code></a></small>
      <div class="d-none name"><code>ecoextract-workflow.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette demonstrates the complete workflow for extracting
structured ecological data from scientific literature PDFs using the
ecoextract ecosystem.</p>
<div class="section level3">
<h3 id="the-three-package-ecosystem">The Three-Package Ecosystem<a class="anchor" aria-label="anchor" href="#the-three-package-ecosystem"></a>
</h3>
<p>The complete workflow involves three packages:</p>
<ol style="list-style-type: decimal">
<li>
<strong><a href="https://github.com/n8layman/ohseer" class="external-link">ohseer</a></strong> - OCR
processing for PDFs
<ul>
<li>Converts PDFs to markdown with embedded images</li>
<li>Uses Tensorlake for vision-based text extraction</li>
<li>Handles tables, figures, and complex layouts</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/n8layman/ecoextract" class="external-link">ecoextract</a></strong> -
Data extraction pipeline (this package)
<ul>
<li>Extracts publication metadata</li>
<li>Extracts structured records using LLM (Claude)</li>
<li>Optional refinement pass</li>
<li>SQLite database storage with full audit trail</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/n8layman/ecoreview" class="external-link">ecoreview</a></strong> -
Human review Shiny app
<ul>
<li>Interactive review interface</li>
<li>Edit, add, or delete records</li>
<li>Automatic accuracy calculation</li>
<li>Edit tracking and audit trail</li>
</ul>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="the-four-step-pipeline">The Four-Step Pipeline<a class="anchor" aria-label="anchor" href="#the-four-step-pipeline"></a>
</h3>
<p>The <code>ecoextract</code> package orchestrates a four-step
extraction pipeline:</p>
<ol style="list-style-type: decimal">
<li>
<strong>OCR Processing</strong> (via ohseer) - Convert PDF to
markdown text with embedded images</li>
<li>
<strong>Metadata Extraction</strong> - Extract publication metadata
(title, authors, DOI, etc.)</li>
<li>
<strong>Data Extraction</strong> - Extract structured records using
LLM according to your schema</li>
<li>
<strong>Refinement</strong> (optional) - Enhance and verify
extracted data</li>
</ol>
<p>After extraction, use <strong>ecoreview</strong> to review and
correct the results.</p>
</div>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>Install all three packages from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install the complete ecosystem</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"n8layman/ohseer"</span><span class="op">)</span>      <span class="co"># OCR processing</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"n8layman/ecoextract"</span><span class="op">)</span>  <span class="co"># Data extraction</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"n8layman/ecoreview"</span><span class="op">)</span>   <span class="co"># Review app (optional)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/n8layman/ecoextract" class="external-link">ecoextract</a></span><span class="op">)</span></span></code></pre></div>
<p><strong>Package Dependencies:</strong></p>
<ul>
<li>
<code>ohseer</code> is required for OCR processing (you can skip OCR
if providing text directly)</li>
<li>
<code>ecoreview</code> is optional but recommended for reviewing and
correcting extraction results</li>
</ul>
</div>
<div class="section level3">
<h3 id="api-key-setup">API Key Setup<a class="anchor" aria-label="anchor" href="#api-key-setup"></a>
</h3>
<p>EcoExtract requires API keys for OCR (Tensorlake) and data extraction
(Anthropic Claude):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a .env file in your project root (make sure it's in .gitignore!)</span></span>
<span><span class="co"># .env file contents:</span></span>
<span><span class="co"># TENSORLAKE_API_KEY=your_tensorlake_key_here</span></span>
<span><span class="co"># ANTHROPIC_API_KEY=your_anthropic_key_here</span></span>
<span></span>
<span><span class="co"># The .env file is automatically loaded when R starts in the project directory</span></span>
<span></span>
<span><span class="co"># Or set keys manually in R:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>TENSORLAKE_API_KEY <span class="op">=</span> <span class="st">"your_tensorlake_key"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>ANTHROPIC_API_KEY <span class="op">=</span> <span class="st">"your_anthropic_key"</span><span class="op">)</span></span></code></pre></div>
<p>Get API keys from:</p>
<ul>
<li>Tensorlake (for OCR): <a href="https://www.tensorlake.ai/" class="external-link uri">https://www.tensorlake.ai/</a>
</li>
<li>Anthropic Claude (for extraction): <a href="https://console.anthropic.com/" class="external-link uri">https://console.anthropic.com/</a>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="quick-start-process-documents">Quick Start: Process Documents<a class="anchor" aria-label="anchor" href="#quick-start-process-documents"></a>
</h3>
<p>The simplest way to process documents is using
<code><a href="../reference/process_documents.html">process_documents()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Process a single PDF</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"my_paper.pdf"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"ecoextract_records.db"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Process all PDFs in a folder</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"ecoextract_records.db"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Process with refinement enabled</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"ecoextract_records.db"</span>,</span>
<span>  run_refinement <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This automatically handles:</p>
<ul>
<li>OCR processing</li>
<li>Metadata extraction</li>
<li>Data extraction with Claude</li>
<li>Optional refinement pass</li>
<li>Saving to SQLite database</li>
<li>Smart skip logic (re-running skips completed steps)</li>
</ul>
</div>
<div class="section level3">
<h3 id="parallel-processing">Parallel Processing<a class="anchor" aria-label="anchor" href="#parallel-processing"></a>
</h3>
<p>For processing multiple documents faster, use parallel processing
with the <code>crew</code> package:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install crew (optional dependency)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"crew"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Process with 4 parallel workers</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"ecoextract_records.db"</span>,</span>
<span>  workers <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With logging for troubleshooting</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"ecoextract_records.db"</span>,</span>
<span>  workers <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># Creates ecoextract_YYYYMMDD_HHMMSS.log</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Benefits of parallel processing:</p>
<ul>
<li>Each worker processes a complete document (all 4 steps)</li>
<li>Crash-resilient: completed documents saved immediately</li>
<li>Progress shown as documents complete:
<code>[1/10] paper.pdf completed</code>
</li>
<li>Re-run to resume: skip logic detects completed documents</li>
</ul>
</div>
<div class="section level3">
<h3 id="understanding-skip-logic">Understanding Skip Logic<a class="anchor" aria-label="anchor" href="#understanding-skip-logic"></a>
</h3>
<p>When you re-run <code><a href="../reference/process_documents.html">process_documents()</a></code>, it automatically
skips steps that have already completed successfully. This allows you
to:</p>
<ul>
<li>Resume interrupted batch processing</li>
<li>Add new PDFs to an existing database</li>
<li>Re-run specific steps after fixing issues</li>
</ul>
<div class="section level4">
<h4 id="skip-behavior">Skip Behavior<a class="anchor" aria-label="anchor" href="#skip-behavior"></a>
</h4>
<p>Each step checks its status in the database:</p>
<table class="table">
<thead><tr class="header">
<th>Step</th>
<th>Skips When</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>OCR</td>
<td>
<code>ocr_status = "completed"</code> AND markdown exists</td>
</tr>
<tr class="even">
<td>Metadata</td>
<td>
<code>metadata_status = "completed"</code> AND metadata exists</td>
</tr>
<tr class="odd">
<td>Extraction</td>
<td>
<code>extraction_status = "completed"</code> AND records exist</td>
</tr>
<tr class="even">
<td>Refinement</td>
<td>
<code>refinement_status = "completed"</code> (opt-in only)</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="cascade-logic">Cascade Logic<a class="anchor" aria-label="anchor" href="#cascade-logic"></a>
</h4>
<p>When a step is re-run, downstream steps are automatically
invalidated:</p>
<table class="table">
<thead><tr class="header">
<th>If This Re-runs</th>
<th>These Become Stale</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>OCR</td>
<td>Metadata, Extraction</td>
</tr>
<tr class="even">
<td>Metadata</td>
<td>Extraction</td>
</tr>
<tr class="odd">
<td>Extraction</td>
<td>(nothing)</td>
</tr>
<tr class="even">
<td>Refinement</td>
<td>(nothing, opt-in only)</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="force-reprocessing">Force Reprocessing<a class="anchor" aria-label="anchor" href="#force-reprocessing"></a>
</h4>
<p>Override skip logic to force reprocessing:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Force reprocess all documents from OCR onward</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"ecoextract_records.db"</span>,</span>
<span>  force_reprocess_ocr <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Force reprocess specific documents only (by document_id)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"ecoextract_records.db"</span>,</span>
<span>  force_reprocess_extraction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5L</span>, <span class="fl">12L</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Force reprocess metadata for all documents</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"ecoextract_records.db"</span>,</span>
<span>  force_reprocess_metadata <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Each <code>force_reprocess_*</code> parameter accepts:</p>
<ul>
<li>
<code>NULL</code> (default) - use normal skip logic</li>
<li>
<code>TRUE</code> - force reprocess all documents</li>
<li>Integer vector (e.g., <code>c(5L, 12L)</code>) - force reprocess
specific document IDs</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="customizing-the-workflow">Customizing the Workflow<a class="anchor" aria-label="anchor" href="#customizing-the-workflow"></a>
</h3>
<div class="section level4">
<h4 id="step-1-initialize-custom-configuration">Step 1: Initialize Custom Configuration<a class="anchor" aria-label="anchor" href="#step-1-initialize-custom-configuration"></a>
</h4>
<p>Create customizable schema and prompt files in your project:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creates ecoextract/ directory with template files</span></span>
<span><span class="fu"><a href="../reference/init_ecoextract.html">init_ecoextract</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This creates:</span></span>
<span><span class="co"># - ecoextract/SCHEMA_GUIDE.md      # Read this first!</span></span>
<span><span class="co"># - ecoextract/schema.json          # Edit for your domain</span></span>
<span><span class="co"># - ecoextract/extraction_prompt.md # Edit for your domain</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="step-2-customize-for-your-domain">Step 2: Customize for Your Domain<a class="anchor" aria-label="anchor" href="#step-2-customize-for-your-domain"></a>
</h4>
<p>Edit the files in <code>ecoextract/</code> to customize for your
research domain.</p>
<p><strong>ecoextract/schema.json</strong> - Define what data to
extract:</p>
<p>The schema must follow this structure:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="dt">"$schema"</span><span class="fu">:</span> <span class="st">"http://json-schema.org/draft-07/schema#"</span><span class="fu">,</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="dt">"title"</span><span class="fu">:</span> <span class="st">"Your Domain Schema"</span><span class="fu">,</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"object"</span><span class="fu">,</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    <span class="dt">"records"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>      <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"array"</span><span class="fu">,</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>      <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Your domain-specific records"</span><span class="fu">,</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>      <span class="dt">"items"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"object"</span><span class="fu">,</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>        <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>          <span class="dt">"field_1"</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span> <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"..."</span><span class="fu">},</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>          <span class="dt">"field_2"</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">"type"</span><span class="fu">:</span> <span class="st">"integer"</span><span class="fu">,</span> <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"..."</span><span class="fu">},</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>          <span class="dt">"location"</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span> <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"..."</span><span class="fu">}</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>  <span class="dt">"required"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"records"</span><span class="ot">]</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Key requirements:</p>
<ul>
<li>Top-level must have a <code>records</code> property (array of
objects)</li>
<li>Each field should have a <code>type</code> and
<code>description</code>
</li>
<li>Use JSON Schema draft-07 format</li>
</ul>
<p><strong>ecoextract/extraction_prompt.md</strong> - Customize
extraction instructions for your domain</p>
</div>
<div class="section level4">
<h4 id="step-3-process-with-custom-configuration">Step 3: Process with Custom Configuration<a class="anchor" aria-label="anchor" href="#step-3-process-with-custom-configuration"></a>
</h4>
<p>The package automatically detects and uses files in
<code>ecoextract/</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Automatically uses ecoextract/schema.json and ecoextract/extraction_prompt.md</span></span>
<span><span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span><span class="st">"pdfs/"</span>, <span class="st">"ecoextract_records.db"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or specify custom files explicitly</span></span>
<span><span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"ecoextract_records.db"</span>,</span>
<span>  schema_file <span class="op">=</span> <span class="st">"my_custom/schema.json"</span>,</span>
<span>  extraction_prompt_file <span class="op">=</span> <span class="st">"my_custom/extraction.md"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="configuration-priority">Configuration Priority<a class="anchor" aria-label="anchor" href="#configuration-priority"></a>
</h4>
<p>The package looks for configuration files in this order:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Explicit parameter</strong> - Files you specify
directly</li>
<li>
<strong>Project ecoextract/ directory</strong> -
<code>ecoextract/schema.json</code>, etc.</li>
<li>
<strong>Working directory with prefix</strong> -
<code>ecoextract_schema.json</code>, etc.</li>
<li>
<strong>Package defaults</strong> - Built-in defaults (bat-plant
interactions example)</li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="retrieving-your-data">Retrieving Your Data<a class="anchor" aria-label="anchor" href="#retrieving-your-data"></a>
</h3>
<p>After processing, use these functions to retrieve and export your
data:</p>
<div class="section level4">
<h4 id="query-records">Query Records<a class="anchor" aria-label="anchor" href="#query-records"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get all records from all documents</span></span>
<span><span class="va">all_records</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_records.html">get_records</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get records from a specific document</span></span>
<span><span class="va">doc_records</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_records.html">get_records</a></span><span class="op">(</span>document_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use a custom database path</span></span>
<span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_records.html">get_records</a></span><span class="op">(</span>db_conn <span class="op">=</span> <span class="st">"my_project.db"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="query-documents">Query Documents<a class="anchor" aria-label="anchor" href="#query-documents"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get all documents and their metadata</span></span>
<span><span class="va">all_docs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_documents.html">get_documents</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get a specific document</span></span>
<span><span class="va">doc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_documents.html">get_documents</a></span><span class="op">(</span>document_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check processing status</span></span>
<span><span class="va">doc</span><span class="op">$</span><span class="va">ocr_status</span>          <span class="co"># "completed", "pending", "failed"</span></span>
<span><span class="va">doc</span><span class="op">$</span><span class="va">metadata_status</span>     <span class="co"># "completed", "pending", "failed"</span></span>
<span><span class="va">doc</span><span class="op">$</span><span class="va">extraction_status</span>   <span class="co"># "completed", "pending", "failed"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="export-data">Export Data<a class="anchor" aria-label="anchor" href="#export-data"></a>
</h4>
<p>The <code><a href="../reference/export_db.html">export_db()</a></code> function joins records with document
metadata:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get all records with metadata as a tibble</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export_db.html">export_db</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export to CSV file</span></span>
<span><span class="fu"><a href="../reference/export_db.html">export_db</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"extracted_data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export only records from specific document</span></span>
<span><span class="fu"><a href="../reference/export_db.html">export_db</a></span><span class="op">(</span>document_id <span class="op">=</span> <span class="fl">1</span>, filename <span class="op">=</span> <span class="st">"document_1.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Include OCR content in export (large files!)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export_db.html">export_db</a></span><span class="op">(</span>include_ocr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simplified export (removes processing metadata columns)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export_db.html">export_db</a></span><span class="op">(</span>simple <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The exported data includes:</p>
<ul>
<li>Document metadata (title, authors, journal, DOI, etc.)</li>
<li>All extracted record fields (defined by your schema)</li>
<li>Processing status and timestamps</li>
</ul>
</div>
<div class="section level4">
<h4 id="view-ocr-results">View OCR Results<a class="anchor" aria-label="anchor" href="#view-ocr-results"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get OCR markdown text</span></span>
<span><span class="va">markdown</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ocr_markdown.html">get_ocr_markdown</a></span><span class="op">(</span>document_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">markdown</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View OCR with embedded images in RStudio Viewer</span></span>
<span><span class="fu"><a href="../reference/get_ocr_html_preview.html">get_ocr_html_preview</a></span><span class="op">(</span>document_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View all pages</span></span>
<span><span class="fu"><a href="../reference/get_ocr_html_preview.html">get_ocr_html_preview</a></span><span class="op">(</span>document_id <span class="op">=</span> <span class="fl">1</span>, page_num <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="deduplication">Deduplication<a class="anchor" aria-label="anchor" href="#deduplication"></a>
</h3>
<p>During extraction, records are automatically deduplicated against
existing records in the database. Three similarity methods are
available:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default: LLM-based deduplication (most accurate)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span><span class="st">"pdfs/"</span>, db_conn <span class="op">=</span> <span class="st">"records.db"</span>,</span>
<span>                            similarity_method <span class="op">=</span> <span class="st">"llm"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Embedding-based with custom threshold</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span><span class="st">"pdfs/"</span>, db_conn <span class="op">=</span> <span class="st">"records.db"</span>,</span>
<span>                            similarity_method <span class="op">=</span> <span class="st">"embedding"</span>,</span>
<span>                            min_similarity <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fast local deduplication (no API calls)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span><span class="st">"pdfs/"</span>, db_conn <span class="op">=</span> <span class="st">"records.db"</span>,</span>
<span>                            similarity_method <span class="op">=</span> <span class="st">"jaccard"</span>,</span>
<span>                            min_similarity <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span></code></pre></div>
<p>Methods:</p>
<ul>
<li>
<strong><code>"llm"</code></strong> (default) - Uses Claude to
semantically compare records</li>
<li>
<strong><code>"embedding"</code></strong> - Cosine similarity on
text embeddings (requires embedding provider)</li>
<li>
<strong><code>"jaccard"</code></strong> - Fast n-gram based
comparison (no API calls)</li>
</ul>
</div>
<div class="section level3">
<h3 id="complete-example-custom-domain">Complete Example: Custom Domain<a class="anchor" aria-label="anchor" href="#complete-example-custom-domain"></a>
</h3>
<p>Here’s a complete example of setting up extraction for a custom
domain (disease outbreaks):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Initialize configuration</span></span>
<span><span class="fu"><a href="../reference/init_ecoextract.html">init_ecoextract</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Edit ecoextract/schema.json for disease outbreaks</span></span>
<span><span class="co"># (manually edit the file to define fields like: disease, location, date, cases, etc.)</span></span>
<span></span>
<span><span class="co"># 3. Edit ecoextract/extraction_prompt.md</span></span>
<span><span class="co"># (manually edit to describe what information to extract about disease outbreaks)</span></span>
<span></span>
<span><span class="co"># 4. Process documents with parallel processing</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"disease_papers/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"disease_outbreaks.db"</span>,</span>
<span>  workers <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  run_refinement <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. Export results</span></span>
<span><span class="va">outbreak_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export_db.html">export_db</a></span><span class="op">(</span></span>
<span>  db_conn <span class="op">=</span> <span class="st">"disease_outbreaks.db"</span>,</span>
<span>  filename <span class="op">=</span> <span class="st">"disease_outbreaks.csv"</span>,</span>
<span>  simple <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 6. Analyze with dplyr</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">outbreak_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">disease</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    total_papers <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">document_id</span><span class="op">)</span>,</span>
<span>    total_outbreaks <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h3>
<div class="section level4">
<h4 id="start-with-defaults">1. Start with Defaults<a class="anchor" aria-label="anchor" href="#start-with-defaults"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use package defaults first to understand the system</span></span>
<span><span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span><span class="st">"test.pdf"</span>, <span class="st">"test.db"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Review the results</span></span>
<span><span class="fu"><a href="../reference/get_records.html">get_records</a></span><span class="op">(</span>db_conn <span class="op">=</span> <span class="st">"test.db"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="test-on-small-batches">2. Test on Small Batches<a class="anchor" aria-label="anchor" href="#test-on-small-batches"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test on 2-3 papers first</span></span>
<span><span class="va">test_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"paper1.pdf"</span>, <span class="st">"paper2.pdf"</span>, <span class="st">"paper3.pdf"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="va">test_files</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"test.db"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Review results before processing entire corpus</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export_db.html">export_db</a></span><span class="op">(</span>db_conn <span class="op">=</span> <span class="st">"test.db"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="use-parallel-processing-for-large-batches">3. Use Parallel Processing for Large Batches<a class="anchor" aria-label="anchor" href="#use-parallel-processing-for-large-batches"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For 10+ papers, use parallel processing</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"large_corpus/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"corpus.db"</span>,</span>
<span>  workers <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="enable-refinement-selectively">4. Enable Refinement Selectively<a class="anchor" aria-label="anchor" href="#enable-refinement-selectively"></a>
</h4>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run refinement only on specific documents that need it</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"records.db"</span>,</span>
<span>  run_refinement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5L</span>, <span class="fl">12L</span>, <span class="fl">18L</span><span class="op">)</span>  <span class="co"># Only these document IDs</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="version-control-your-configs">5. Version Control Your Configs<a class="anchor" aria-label="anchor" href="#version-control-your-configs"></a>
</h4>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add custom configs to git</span></span>
<span><span class="co"># .gitignore should exclude .env (API keys) but include ecoextract/ configs</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="monitor-api-usage">6. Monitor API Usage<a class="anchor" aria-label="anchor" href="#monitor-api-usage"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extraction and refinement use Claude API</span></span>
<span><span class="co"># Monitor usage at: https://console.anthropic.com/</span></span>
<span></span>
<span><span class="co"># Typical usage per paper:</span></span>
<span><span class="co"># - OCR: ~2,000-5,000 tokens (Tensorlake)</span></span>
<span><span class="co"># - Metadata: ~1,000-2,000 tokens (Claude)</span></span>
<span><span class="co"># - Extraction: ~5,000-10,000 tokens (Claude)</span></span>
<span><span class="co"># - Refinement: ~3,000-5,000 tokens (Claude)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h3>
<div class="section level4">
<h4 id="api-key-not-found">API Key Not Found<a class="anchor" aria-label="anchor" href="#api-key-not-found"></a>
</h4>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Error: API key not found</span></span>
<span></span>
<span><span class="co"># Solution 1: Load from .env file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRenviron.html" class="external-link">readRenviron</a></span><span class="op">(</span><span class="st">".env"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Solution 2: Set directly in R</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>ANTHROPIC_API_KEY <span class="op">=</span> <span class="st">"sk-ant-..."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>TENSORLAKE_API_KEY <span class="op">=</span> <span class="st">"..."</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Verify keys are set</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"ANTHROPIC_API_KEY"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="database-locked-errors">Database Locked Errors<a class="anchor" aria-label="anchor" href="#database-locked-errors"></a>
</h4>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If you get "database is locked" errors during parallel processing,</span></span>
<span><span class="co"># this usually means SQLite WAL mode isn't enabled properly.</span></span>
<span></span>
<span><span class="co"># The package handles this automatically, but you can verify:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"records.db"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"PRAGMA journal_mode"</span><span class="op">)</span>  <span class="co"># Should return "wal"</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="schema-validation-errors">Schema Validation Errors<a class="anchor" aria-label="anchor" href="#schema-validation-errors"></a>
</h4>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If extraction fails, check your schema</span></span>
<span></span>
<span><span class="co"># 1. Validate JSON syntax</span></span>
<span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/validate.html" class="external-link">validate</a></span><span class="op">(</span><span class="st">"ecoextract/schema.json"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Verify schema structure (must have top-level "records" property)</span></span>
<span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/read_json.html" class="external-link">read_json</a></span><span class="op">(</span><span class="st">"ecoextract/schema.json"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">schema</span><span class="op">$</span><span class="va">properties</span><span class="op">)</span>  <span class="co"># Should include "records"</span></span>
<span></span>
<span><span class="co"># 3. Test with default schema first</span></span>
<span><span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span><span class="st">"test.pdf"</span>, <span class="st">"test.db"</span>, schema_file <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="ocr-failures">OCR Failures<a class="anchor" aria-label="anchor" href="#ocr-failures"></a>
</h4>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If OCR fails, check document status</span></span>
<span><span class="va">docs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_documents.html">get_documents</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">docs</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ocr_status</span> <span class="op">==</span> <span class="st">"failed"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Force reprocess failed OCR</span></span>
<span><span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"records.db"</span>,</span>
<span>  force_reprocess_ocr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5L</span><span class="op">)</span>  <span class="co"># Document ID that failed</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="understanding-the-database-schema">Understanding the Database Schema<a class="anchor" aria-label="anchor" href="#understanding-the-database-schema"></a>
</h3>
<p>The SQLite database has two main tables:</p>
<div class="section level4">
<h4 id="documents-table">documents table<a class="anchor" aria-label="anchor" href="#documents-table"></a>
</h4>
<p>Stores document metadata and processing status:</p>
<ul>
<li>
<code>document_id</code> - Primary key</li>
<li>
<code>file_name</code>, <code>file_path</code> - Original PDF
location</li>
<li>
<code>title</code>, <code>authors</code>,
<code>publication_year</code>, <code>journal</code>, <code>doi</code> -
Publication metadata</li>
<li>
<code>document_content</code> - OCR markdown text</li>
<li>
<code>ocr_status</code>, <code>metadata_status</code>,
<code>extraction_status</code>, <code>refinement_status</code> -
Processing status</li>
<li>
<code>records_extracted</code> - Count of records extracted</li>
</ul>
</div>
<div class="section level4">
<h4 id="records-table">records table<a class="anchor" aria-label="anchor" href="#records-table"></a>
</h4>
<p>Stores extracted data records:</p>
<ul>
<li>
<code>id</code> - Primary key (auto-increment)</li>
<li>
<code>document_id</code> - Foreign key to documents</li>
<li>
<code>record_id</code> - Human-readable identifier (e.g.,
“Smith2023-001”)</li>
<li>Custom fields defined by your schema</li>
<li>
<code>extraction_timestamp</code>, <code>llm_model_version</code> -
Metadata</li>
</ul>
</div>
<div class="section level4">
<h4 id="record_edits-table">record_edits table<a class="anchor" aria-label="anchor" href="#record_edits-table"></a>
</h4>
<p>Audit trail for human edits (used by review workflows):</p>
<ul>
<li>Tracks column-level changes</li>
<li>Stores original values</li>
<li>Records edit timestamps</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="human-review-workflow">Human Review Workflow<a class="anchor" aria-label="anchor" href="#human-review-workflow"></a>
</h3>
<p>After extraction, you can review and edit records using the
<strong>ecoreview</strong> Shiny application:</p>
<div class="section level4">
<h4 id="install-ecoreview">Install ecoreview<a class="anchor" aria-label="anchor" href="#install-ecoreview"></a>
</h4>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install from GitHub</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"n8layman/ecoreview"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="launch-review-app">Launch Review App<a class="anchor" aria-label="anchor" href="#launch-review-app"></a>
</h4>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ecoreview</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Launch the review app with your database</span></span>
<span><span class="fu">run_review_app</span><span class="op">(</span>db_path <span class="op">=</span> <span class="st">"ecoextract_records.db"</span><span class="op">)</span></span></code></pre></div>
<p>The review app provides:</p>
<ul>
<li>
<strong>Document-by-document review</strong> - Navigate through all
processed documents</li>
<li>
<strong>Side-by-side view</strong> - See OCR text and extracted
records together</li>
<li>
<strong>Edit records</strong> - Modify extracted data directly in
the app</li>
<li>
<strong>Add records</strong> - Manually add records that the LLM
missed</li>
<li>
<strong>Delete records</strong> - Remove incorrect records</li>
<li>
<strong>Automatic audit trail</strong> - All edits tracked in
<code>record_edits</code> table</li>
<li>
<strong>Accuracy metrics</strong> - Calculate extraction accuracy
based on human edits</li>
</ul>
</div>
<div class="section level4">
<h4 id="review-workflow-example">Review Workflow Example<a class="anchor" aria-label="anchor" href="#review-workflow-example"></a>
</h4>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Process documents</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"papers/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"records.db"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Launch review app</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ecoreview</span><span class="op">)</span></span>
<span><span class="fu">run_review_app</span><span class="op">(</span>db_path <span class="op">=</span> <span class="st">"records.db"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Review and edit records in the Shiny app</span></span>
<span><span class="co">#    - Click through documents</span></span>
<span><span class="co">#    - Edit incorrect fields</span></span>
<span><span class="co">#    - Add missing records</span></span>
<span><span class="co">#    - Delete duplicates or errors</span></span>
<span><span class="co">#    - Click "Accept" to save changes</span></span>
<span></span>
<span><span class="co"># 4. Export final data with edits</span></span>
<span><span class="va">final_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export_db.html">export_db</a></span><span class="op">(</span></span>
<span>  db_conn <span class="op">=</span> <span class="st">"records.db"</span>,</span>
<span>  filename <span class="op">=</span> <span class="st">"final_data.csv"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check which records were edited</span></span>
<span><span class="va">edited_records</span> <span class="op">&lt;-</span> <span class="va">final_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">human_edited</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="edit-tracking">Edit Tracking<a class="anchor" aria-label="anchor" href="#edit-tracking"></a>
</h4>
<p>The <code><a href="../reference/save_document.html">save_document()</a></code> function (used by ecoreview) tracks
all changes:</p>
<ul>
<li>
<strong>Column-level edits</strong> - Knows exactly which fields
were changed</li>
<li>
<strong>Original values</strong> - Stores the LLM’s original
extraction</li>
<li>
<strong>Edit timestamps</strong> - When each change was made</li>
<li>
<strong>Added/deleted flags</strong> - Distinguishes human-added vs
LLM-extracted records</li>
</ul>
<p>This audit trail enables:</p>
<ul>
<li>Accuracy calculations</li>
<li>Understanding LLM performance</li>
<li>Training data for fine-tuning</li>
<li>Quality control</li>
</ul>
<p>For more information, see the <a href="https://github.com/n8layman/ecoreview" class="external-link">ecoreview
repository</a>.</p>
</div>
<div class="section level4">
<h4 id="calculate-accuracy-metrics">Calculate Accuracy Metrics<a class="anchor" aria-label="anchor" href="#calculate-accuracy-metrics"></a>
</h4>
<p>After reviewing documents, calculate comprehensive accuracy
metrics:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate accuracy for all verified documents</span></span>
<span><span class="va">accuracy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_accuracy.html">calculate_accuracy</a></span><span class="op">(</span><span class="st">"ecoextract_records.db"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View key metrics</span></span>
<span><span class="va">accuracy</span><span class="op">$</span><span class="va">detection_recall</span>      <span class="co"># Did we find the records?</span></span>
<span><span class="va">accuracy</span><span class="op">$</span><span class="va">field_precision</span>       <span class="co"># How accurate were the fields?</span></span>
<span><span class="va">accuracy</span><span class="op">$</span><span class="va">major_edit_rate</span>       <span class="co"># How serious were the errors?</span></span>
<span><span class="va">accuracy</span><span class="op">$</span><span class="va">avg_edits_per_document</span> <span class="co"># Average corrections needed</span></span></code></pre></div>
<p>EcoExtract provides nuanced accuracy metrics that separate:</p>
<ul>
<li>
<strong>Record detection</strong>: Finding records vs
missing/hallucinating them</li>
<li>
<strong>Field-level accuracy</strong>: Correctness of individual
fields (gives partial credit)</li>
<li>
<strong>Edit severity</strong>: Major edits (unique/required fields)
vs minor edits</li>
</ul>
<p>For a complete explanation of how accuracy is calculated and why, see
<a href="../ACCURACY.html">ACCURACY.md</a>.</p>
<p>Accuracy visualizations (confusion matrices, heatmaps) are available
in the <a href="https://github.com/n8layman/ecoreview" class="external-link">ecoreview</a>
Shiny app.</p>
</div>
</div>
<div class="section level3">
<h3 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h3>
<ul>
<li>Review the package functions: <code><a href="../reference/process_documents.html">?process_documents</a></code>,
<code><a href="../reference/get_records.html">?get_records</a></code>, <code><a href="../reference/export_db.html">?export_db</a></code>
</li>
<li>Read the schema guide: Run <code><a href="../reference/init_ecoextract.html">init_ecoextract()</a></code> and read
<code>ecoextract/SCHEMA_GUIDE.md</code>
</li>
<li>Learn about database structure:
<code><a href="../reference/init_ecoextract_database.html">?init_ecoextract_database</a></code>
</li>
<li>Check the GitHub repos:
<ul>
<li>
<a href="https://github.com/n8layman/ecoextract" class="external-link">ecoextract</a> -
Main extraction package</li>
<li>
<a href="https://github.com/n8layman/ecoreview" class="external-link">ecoreview</a> -
Review Shiny app</li>
<li>
<a href="https://github.com/n8layman/ohseer" class="external-link">ohseer</a> - OCR
package</li>
</ul>
</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Your Name.</p>
</div>

<div class="pkgdown-footer-right">
  <p>list(text = “EcoExtract - Structured ecological data extraction from scientific literature”)</p>
</div>

    </footer>
</div>





  
</body>
</html>
