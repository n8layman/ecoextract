<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Ecological Data Extraction and Refinement • ecoextract</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Ecological Data Extraction and Refinement">
<meta name="description" content="Structured ecological data extraction and refinement from scientific literature. Provides functions for OCR processing, extracting structured data from documents, and refining extracted data using LLMs.">
<meta property="og:description" content="Structured ecological data extraction and refinement from scientific literature. Provides functions for OCR processing, extracting structured data from documents, and refining extracted data using LLMs.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">ecoextract</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/getting-started.html">Getting Started with EcoExtract</a></li>
    <li><a class="dropdown-item" href="articles/ecoextract-workflow.html">Complete Workflow: From PDF to Database</a></li>
    <li><a class="dropdown-item" href="articles/configuration.html">Configuring EcoExtract for Your Data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/n8layman/ecoextract/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="ecoextract">EcoExtract<a class="anchor" aria-label="anchor" href="#ecoextract"></a>
</h1></div>
<p>Structured ecological data extraction and refinement from scientific literature.</p>
<p>EcoExtract automates the extraction of structured data from PDFs using OCR and LLMs. It’s domain-agnostic and works with any JSON schema you define.</p>
<p><strong>Quick Links:</strong></p>
<ul>
<li>
<a href="https://n8layman.github.io/ecoextract/">Documentation</a> (GitHub Pages)</li>
<li><a href="https://n8layman.github.io/ecoextract/articles/getting-started.html">Getting Started</a></li>
<li>
<a href="https://n8layman.github.io/ecoextract/articles/ecoextract-workflow.html">Full Tutorial</a> (Comprehensive vignette)</li>
<li><a href="https://n8layman.github.io/ecoextract/articles/configuration.html">Configuration Guide</a></li>
<li>
<a href="ACCURACY.html">Accuracy Metrics Guide</a> (Understanding accuracy calculations)</li>
<li>
<a href="https://github.com/n8layman/ecoreview" class="external-link">ecoreview on GitHub</a> (Review Shiny app)</li>
<li>
<a href="https://github.com/n8layman/ohseer" class="external-link">ohseer on GitHub</a> (OCR dependency)</li>
</ul>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="section level3">
<h3 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h3>
<p>First, install the required <code>ohseer</code> package for OCR processing:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Option 1: Using pak (recommended)</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"n8layman/ohseer"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 2: Using devtools</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"n8layman/ohseer"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 3: Using remotes</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"n8layman/ohseer"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 4: Using renv</span></span>
<span><span class="fu">renv</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/renv/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"n8layman/ohseer"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="install-ecoextract">Install ecoextract<a class="anchor" aria-label="anchor" href="#install-ecoextract"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Option 1: Using pak (recommended)</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"n8layman/ecoextract"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 2: Using devtools</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"n8layman/ecoextract"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 3: Using remotes</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"n8layman/ecoextract"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 4: Using renv</span></span>
<span><span class="fu">renv</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/renv/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"n8layman/ecoextract"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Then load the library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/n8layman/ecoextract" class="external-link">ecoextract</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="api-key-setup">API Key Setup<a class="anchor" aria-label="anchor" href="#api-key-setup"></a>
</h2>
<p>EcoExtract uses <a href="https://ellmer.tidyverse.org/" class="external-link">ellmer</a> for LLM interactions. OCR processing via <a href="https://github.com/n8layman/ohseer" class="external-link">ohseer</a> uses Tensorlake.</p>
<div class="section level3">
<h3 id="getting-api-keys">Getting API Keys<a class="anchor" aria-label="anchor" href="#getting-api-keys"></a>
</h3>
<p>Required:</p>
<ul>
<li>Tensorlake (for OCR): <a href="https://www.tensorlake.ai/" class="external-link uri">https://www.tensorlake.ai/</a>
</li>
</ul>
<p>Recommended for data extraction:</p>
<ul>
<li>Anthropic Claude: <a href="https://console.anthropic.com/" class="external-link uri">https://console.anthropic.com/</a>
</li>
</ul>
<p>Note: While ecoextract is designed to work with any ellmer-supported LLM provider (OpenAI, etc.), this has not been fully tested.</p>
</div>
<div class="section level3">
<h3 id="setting-up-api-keys">Setting Up API Keys<a class="anchor" aria-label="anchor" href="#setting-up-api-keys"></a>
</h3>
<p><strong>IMPORTANT: Before creating your <code>.env</code> file, verify it’s gitignored:</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Check that .env is in .gitignore</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">grep</span> <span class="st">"^\.env$"</span> .gitignore</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># If not found, add it NOW before creating the file:</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="bu">echo</span> <span class="st">".env"</span> <span class="op">&gt;&gt;</span> .gitignore</span></code></pre></div>
<p>Create a <code>.env</code> file in the project root directory:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># .env</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="va">ANTHROPIC_API_KEY</span><span class="op">=</span>your_anthropic_api_key_here</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="va">TENSORLAKE_API_KEY</span><span class="op">=</span>your_tensorlake_api_key_here</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co"># Or use other providers supported by ellmer</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="va">OPENAI_API_KEY</span><span class="op">=</span>your_openai_api_key_here</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co"># ... etc</span></span></code></pre></div>
<p><strong>Verify before committing:</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># This should show no output if .env is properly ignored:</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">git</span> status <span class="kw">|</span> <span class="fu">grep</span> <span class="st">".env"</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># If .env appears, do NOT commit! Add it to .gitignore first.</span></span></code></pre></div>
<p><strong>The <code>.env</code> file is automatically loaded</strong> when you start R in this project directory (via <code>.Rprofile</code>). Just restart your R session after creating the file.</p>
<p>Alternatively, load manually:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Option 1: Use readRenviron for a specific file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRenviron.html" class="external-link">readRenviron</a></span><span class="op">(</span><span class="st">".env"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 2: Set directly in R</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>ANTHROPIC_API_KEY <span class="op">=</span> <span class="st">"your_key_here"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-different-llm-providers">Using Different LLM Providers<a class="anchor" aria-label="anchor" href="#using-different-llm-providers"></a>
</h3>
<p>By default, ecoextract uses <code>anthropic/claude-sonnet-4-5</code> for data extraction, metadata, and refinement. If you have an Anthropic API key set up, no additional configuration is needed.</p>
<p>To use a different LLM provider, pass the <code>model</code> parameter:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default (Anthropic Claude) - no model parameter needed</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"path/to/pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"ecoextract_records.db"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use a different model (experimental - not fully tested)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"path/to/pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"ecoextract_records.db"</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"openai/gpt-4"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/n8layman/ecoextract" class="external-link">ecoextract</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Process all PDFs in a folder through complete 4-step workflow:</span></span>
<span><span class="co"># 1. OCR (extract text from PDF)</span></span>
<span><span class="co"># 2. Metadata (extract publication metadata)</span></span>
<span><span class="co"># 3. Extraction (extract domain-specific records)</span></span>
<span><span class="co"># 4. Refinement (refine and validate records, opt-in)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"path/to/pdfs/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"ecoextract_records.db"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve your data</span></span>
<span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_records.html">get_records</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/export_db.html">export_db</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"extracted_data.csv"</span><span class="op">)</span></span></code></pre></div>
<p><strong>See the <a href="https://n8layman.github.io/ecoextract/articles/ecoextract-workflow.html">vignette</a> for:</strong></p>
<ul>
<li>Parallel processing with multiple workers</li>
<li>Custom schemas and prompts</li>
<li>Skip logic and force reprocessing</li>
<li>Data retrieval and export options</li>
<li>Complete workflow examples</li>
</ul>
</div>
<div class="section level2">
<h2 id="key-features">Key Features<a class="anchor" aria-label="anchor" href="#key-features"></a>
</h2>
<div class="section level3">
<h3 id="smart-skip-logic">Smart Skip Logic<a class="anchor" aria-label="anchor" href="#smart-skip-logic"></a>
</h3>
<p>Re-running <code><a href="reference/process_documents.html">process_documents()</a></code> automatically skips completed steps. When a step is forced to re-run, downstream steps are automatically invalidated.</p>
<p>See the <a href="https://n8layman.github.io/ecoextract/articles/ecoextract-workflow.html">vignette</a> for details.</p>
</div>
<div class="section level3">
<h3 id="parallel-processing">Parallel Processing<a class="anchor" aria-label="anchor" href="#parallel-processing"></a>
</h3>
<p>Process multiple documents in parallel using the <code>crew</code> package:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"crew"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/process_documents.html">process_documents</a></span><span class="op">(</span></span>
<span>  pdf_path <span class="op">=</span> <span class="st">"papers/"</span>,</span>
<span>  db_conn <span class="op">=</span> <span class="st">"records.db"</span>,</span>
<span>  workers <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Crash-resilient with automatic resume capability. See the <a href="https://n8layman.github.io/ecoextract/articles/ecoextract-workflow.html">vignette</a> for details.</p>
</div>
<div class="section level3">
<h3 id="deduplication">Deduplication<a class="anchor" aria-label="anchor" href="#deduplication"></a>
</h3>
<p>Three similarity methods available: <code>"llm"</code> (default), <code>"embedding"</code>, or <code>"jaccard"</code>. See the <a href="https://n8layman.github.io/ecoextract/articles/ecoextract-workflow.html">vignette</a> for details.</p>
</div>
</div>
<div class="section level2">
<h2 id="custom-schemas">Custom Schemas<a class="anchor" aria-label="anchor" href="#custom-schemas"></a>
</h2>
<p>EcoExtract is domain-agnostic and works with any JSON schema:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create custom config directory with templates</span></span>
<span><span class="fu"><a href="reference/init_ecoextract.html">init_ecoextract</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Edit the generated files:</span></span>
<span><span class="co"># - ecoextract/schema.json          # Define your data structure</span></span>
<span><span class="co"># - ecoextract/extraction_prompt.md # Describe what to extract</span></span>
<span></span>
<span><span class="co"># The package automatically uses these files</span></span>
<span><span class="fu"><a href="reference/process_documents.html">process_documents</a></span><span class="op">(</span><span class="st">"pdfs/"</span>, <span class="st">"records.db"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Schema Requirements:</strong></p>
<ul>
<li>Top-level must have a <code>records</code> property (array of objects)</li>
<li>Each field needs <code>type</code> and <code>description</code>
</li>
<li>Use JSON Schema draft-07 format</li>
</ul>
<p>See the <a href="vignettes/ecoextract-workflow.Rmd">vignette</a> and <code>ecoextract/SCHEMA_GUIDE.md</code> for complete details and examples.</p>
</div>
<div class="section level2">
<h2 id="data-retrieval">Data Retrieval<a class="anchor" aria-label="anchor" href="#data-retrieval"></a>
</h2>
<p>After processing documents, use these functions to retrieve and export your data:</p>
<div class="section level3">
<h3 id="query-records">Query Records<a class="anchor" aria-label="anchor" href="#query-records"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get all records from all documents</span></span>
<span><span class="va">all_records</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_records.html">get_records</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get records from a specific document</span></span>
<span><span class="va">doc_records</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_records.html">get_records</a></span><span class="op">(</span>document_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use a custom database path</span></span>
<span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_records.html">get_records</a></span><span class="op">(</span>db_conn <span class="op">=</span> <span class="st">"my_project.db"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="query-documents">Query Documents<a class="anchor" aria-label="anchor" href="#query-documents"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get all documents and their metadata</span></span>
<span><span class="va">all_docs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_documents.html">get_documents</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get a specific document</span></span>
<span><span class="va">doc</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_documents.html">get_documents</a></span><span class="op">(</span>document_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check processing status</span></span>
<span><span class="va">doc</span><span class="op">$</span><span class="va">ocr_status</span>          <span class="co"># "completed", "pending", "failed"</span></span>
<span><span class="va">doc</span><span class="op">$</span><span class="va">metadata_status</span>     <span class="co"># "completed", "pending", "failed"</span></span>
<span><span class="va">doc</span><span class="op">$</span><span class="va">extraction_status</span>   <span class="co"># "completed", "pending", "failed"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="export-data">Export Data<a class="anchor" aria-label="anchor" href="#export-data"></a>
</h3>
<p>The <code><a href="reference/export_db.html">export_db()</a></code> function joins records with document metadata for easy export:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get all records with metadata as a tibble</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/export_db.html">export_db</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export to CSV file</span></span>
<span><span class="fu"><a href="reference/export_db.html">export_db</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"extracted_data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export only records from specific document</span></span>
<span><span class="fu"><a href="reference/export_db.html">export_db</a></span><span class="op">(</span>document_id <span class="op">=</span> <span class="fl">1</span>, filename <span class="op">=</span> <span class="st">"document_1.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Include OCR text in export (large files!)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/export_db.html">export_db</a></span><span class="op">(</span>include_ocr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simplified export (removes processing metadata columns)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/export_db.html">export_db</a></span><span class="op">(</span>simple <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The exported data includes:</p>
<ul>
<li>Document metadata (title, authors, journal, DOI, etc.)</li>
<li>All extracted record fields (defined by your schema)</li>
<li>Processing status and timestamps</li>
</ul>
</div>
<div class="section level3">
<h3 id="view-ocr-results">View OCR Results<a class="anchor" aria-label="anchor" href="#view-ocr-results"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get OCR markdown text</span></span>
<span><span class="va">markdown</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_ocr_markdown.html">get_ocr_markdown</a></span><span class="op">(</span>document_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">markdown</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View OCR with embedded images in RStudio Viewer</span></span>
<span><span class="fu"><a href="reference/get_ocr_html_preview.html">get_ocr_html_preview</a></span><span class="op">(</span>document_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View all pages</span></span>
<span><span class="fu"><a href="reference/get_ocr_html_preview.html">get_ocr_html_preview</a></span><span class="op">(</span>document_id <span class="op">=</span> <span class="fl">1</span>, page_num <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="database-statistics">Database Statistics<a class="anchor" aria-label="anchor" href="#database-statistics"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get summary counts</span></span>
<span><span class="fu"><a href="reference/get_db_stats.html">get_db_stats</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Returns: documents_count, records_count, documents_with_records</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="human-review-workflow">Human Review Workflow<a class="anchor" aria-label="anchor" href="#human-review-workflow"></a>
</h2>
<p>After extraction, you can review and edit records using the <strong>ecoreview</strong> Shiny application:</p>
<div class="section level3">
<h3 id="install-ecoreview">Install ecoreview<a class="anchor" aria-label="anchor" href="#install-ecoreview"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install from GitHub</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"n8layman/ecoreview"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="launch-review-app">Launch Review App<a class="anchor" aria-label="anchor" href="#launch-review-app"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ecoreview</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Launch the review app with your database</span></span>
<span><span class="fu">run_review_app</span><span class="op">(</span>db_path <span class="op">=</span> <span class="st">"ecoextract_records.db"</span><span class="op">)</span></span></code></pre></div>
<p>The review app provides:</p>
<ul>
<li>Document-by-document review interface</li>
<li>Side-by-side view of OCR text and extracted records</li>
<li>Edit records directly in the app</li>
<li>Add new records manually</li>
<li>Delete incorrect records</li>
<li>Automatic edit tracking and audit trail (stored in <code>record_edits</code> table)</li>
<li>Accuracy calculation based on edits</li>
</ul>
<p>All edits are saved to the database using <code><a href="reference/save_document.html">save_document()</a></code>, which tracks:</p>
<ul>
<li>Which columns were modified</li>
<li>Original values before edits</li>
<li>Edit timestamps</li>
<li>Records added or deleted by humans</li>
</ul>
<p>For more information, see the <a href="https://github.com/n8layman/ecoreview" class="external-link">ecoreview repository</a>.</p>
</div>
<div class="section level3">
<h3 id="calculate-accuracy-metrics">Calculate Accuracy Metrics<a class="anchor" aria-label="anchor" href="#calculate-accuracy-metrics"></a>
</h3>
<p>After reviewing documents, calculate comprehensive accuracy metrics:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate accuracy for all verified documents</span></span>
<span><span class="va">accuracy</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calculate_accuracy.html">calculate_accuracy</a></span><span class="op">(</span><span class="st">"ecoextract_records.db"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View key metrics</span></span>
<span><span class="va">accuracy</span><span class="op">$</span><span class="va">detection_recall</span>      <span class="co"># Did we find the records?</span></span>
<span><span class="va">accuracy</span><span class="op">$</span><span class="va">field_precision</span>       <span class="co"># How accurate were the fields?</span></span>
<span><span class="va">accuracy</span><span class="op">$</span><span class="va">major_edit_rate</span>       <span class="co"># How serious were the errors?</span></span>
<span><span class="va">accuracy</span><span class="op">$</span><span class="va">avg_edits_per_document</span> <span class="co"># Average corrections needed</span></span></code></pre></div>
<p>EcoExtract provides nuanced accuracy metrics that separate: - <strong>Record detection</strong>: Finding records vs missing/hallucinating them - <strong>Field-level accuracy</strong>: Correctness of individual fields (gives partial credit) - <strong>Edit severity</strong>: Major edits (unique/required fields) vs minor edits</p>
<p>For a complete explanation of how accuracy is calculated and interpreted, see <a href="ACCURACY.html">ACCURACY.md</a>.</p>
<p>Accuracy visualizations (confusion matrices, heatmaps) are available in <a href="https://github.com/n8layman/ecoreview" class="external-link">ecoreview</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="package-functions">Package Functions<a class="anchor" aria-label="anchor" href="#package-functions"></a>
</h2>
<div class="section level3">
<h3 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h3>
<ul>
<li>
<code><a href="reference/process_documents.html">process_documents()</a></code> - Complete 4-step workflow (OCR -&gt; Metadata -&gt; Extract -&gt; Refine)</li>
</ul>
</div>
<div class="section level3">
<h3 id="database-setup">Database Setup<a class="anchor" aria-label="anchor" href="#database-setup"></a>
</h3>
<ul>
<li>
<code><a href="reference/init_ecoextract_database.html">init_ecoextract_database()</a></code> - Initialize database with schema</li>
<li>
<code><a href="reference/init_ecoextract.html">init_ecoextract()</a></code> - Create project config directory with template schema and prompts</li>
</ul>
</div>
<div class="section level3">
<h3 id="data-access">Data Access<a class="anchor" aria-label="anchor" href="#data-access"></a>
</h3>
<ul>
<li>
<code><a href="reference/get_documents.html">get_documents()</a></code> - Query documents and their metadata from database</li>
<li>
<code><a href="reference/get_records.html">get_records()</a></code> - Query extracted records from database</li>
<li>
<code><a href="reference/get_ocr_markdown.html">get_ocr_markdown()</a></code> - Get OCR markdown text for a document</li>
<li>
<code><a href="reference/get_ocr_html_preview.html">get_ocr_html_preview()</a></code> - Render OCR output with embedded images as HTML</li>
<li>
<code><a href="reference/get_db_stats.html">get_db_stats()</a></code> - Get document and record counts from database</li>
<li>
<code><a href="reference/export_db.html">export_db()</a></code> - Export records with metadata to tibble or CSV file</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a>
</h2>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run all tests</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/test.html" class="external-link">test</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run package checks</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">check</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="integration-tests">Integration Tests<a class="anchor" aria-label="anchor" href="#integration-tests"></a>
</h3>
<p>Integration tests verify API interactions with LLM providers. To run these locally, set up API keys in a <code>.env</code> file (see API Key Setup above). The tests will automatically load <code>.env</code> files, or you can load them manually:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/n8layman/ecoextract" class="external-link">ecoextract</a></span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/test.html" class="external-link">test</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>See <a href="CONTRIBUTING.html">CONTRIBUTING.md</a> for more details on testing and development workflow.</p>
</div>
</div>
<div class="section level2">
<h2 id="file-structure">File Structure<a class="anchor" aria-label="anchor" href="#file-structure"></a>
</h2>
<pre class="text"><code>ecoextract/
├── R/
│   ├── workflow.R          # Main process_documents() workflow + skip/cascade logic
│   ├── ocr.R               # OCR processing
│   ├── metadata.R          # Publication metadata extraction
│   ├── extraction.R        # Data extraction functions
│   ├── refinement.R        # Data refinement functions
│   ├── deduplication.R     # Record deduplication (LLM, embedding, Jaccard)
│   ├── database.R          # Database operations
│   ├── getters.R           # Data access functions (get_*, export_db)
│   ├── config_loader.R     # Configuration file loading + init_ecoextract()
│   ├── prompts.R           # Prompt loading
│   ├── utils.R             # Utilities
│   ├── config.R            # Package configuration
│   └── ecoextract-package.R # Package metadata
├── inst/
│   ├── extdata/            # Schema files
│   │   ├── schema.json
│   │   └── metadata_schema.json
│   └── prompts/            # System prompts
│       ├── extraction_prompt.md
│       ├── extraction_context.md
│       ├── metadata_prompt.md
│       ├── metadata_context.md
│       ├── refinement_prompt.md
│       ├── refinement_context.md
│       └── deduplication_prompt.md
├── tests/testthat/         # Tests
├── vignettes/              # Package vignettes
├── DESCRIPTION
├── NAMESPACE
├── CONTRIBUTING.md         # Development guide
└── README.md</code></pre>
</div>
<div class="section level2">
<h2 id="tech-stack">Tech Stack<a class="anchor" aria-label="anchor" href="#tech-stack"></a>
</h2>
<div class="section level3">
<h3 id="r-packages">R Packages<a class="anchor" aria-label="anchor" href="#r-packages"></a>
</h3>
<ul>
<li>
<a href="https://ellmer.tidyverse.org/" class="external-link"><code>ellmer</code></a> - Structured LLM outputs</li>
<li>
<a href="https://github.com/n8layman/ohseer" class="external-link"><code>ohseer</code></a> - OCR processing</li>
<li>
<code>dplyr</code> - Data manipulation</li>
<li>
<code>DBI</code> &amp; <code>RSQLite</code> - Database operations</li>
<li>
<code>jsonlite</code> - JSON handling</li>
<li>
<code>glue</code> - String interpolation</li>
<li>
<code>stringr</code> &amp; <code>stringi</code> - String manipulation</li>
<li>
<code>digest</code> - Hashing</li>
<li>
<code>tidyllm</code> - LLM deduplication</li>
</ul>
</div>
<div class="section level3">
<h3 id="external-apis">External APIs<a class="anchor" aria-label="anchor" href="#external-apis"></a>
</h3>
<ul>
<li>Tensorlake - OCR processing (via ohseer)</li>
<li>Anthropic Claude / OpenAI / other LLM providers - Data extraction and refinement (via ellmer)</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>MIT License</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/n8layman/ecoextract/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/n8layman/ecoextract/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ecoextract</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Your Name <br><small class="roles"> Maintainer </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Your Name.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
